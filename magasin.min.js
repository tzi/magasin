var magasin=function(){var just=function(){function compare(value1,value2){return value1===value2||typeof value1==typeof value2&&(value1===Object(value1)&&(!!value1&&(Array.isArray(value1)?function(value1,value2){var len=value1.length;if(len!=value2.length)return!1;for(var alike=!0,i=0;i<len;i++)if(!compare(value1[i],value2[i])){alike=!1;break}return alike}(value1,value2):"[object Object]"=={}.toString.call(value1)?function(value1,value2){var keys1=Object.keys(value1).sort(),keys2=Object.keys(value2).sort(),len=keys1.length;if(len!=keys2.length)return!1;for(var i=0;i<len;i++){var key1=keys1[i],key2=keys2[i];if(key1!=key2||!compare(value1[key1],value2[key2]))return!1}return!0}(value1,value2):function(value1,value2){return value1.toString()===value2.toString()}(value1,value2))))}return{set:function(obj,props,value){"string"==typeof props&&(props=props.split("."));var thisProp,lastProp=props.pop();if(!lastProp)return!1;for(;thisProp=props.shift();)if(void 0===obj[thisProp]&&(obj[thisProp]={}),!(obj=obj[thisProp])||"object"!=typeof obj)return!1;return obj[lastProp]=value,!0},get:function(obj,props){var prop;for("string"==typeof props&&(props=props.split("."));prop=props.shift();)if(!(obj=obj[prop]))return obj;return obj},compare:compare}}();return function(){var state={},handlers=[];return{getState:function(){return state},set:function(key,value){just.set(state,key,value),handlers.forEach(function(handler){handler()})},subscribe:{onUpdate:function(selector,onChange){var selection={};function handleChange(){var previousSelection=selection;selection=function(state,selector){if("function"==typeof selector){var result=selector(state);return Array.isArray(result)?result:[result]}var keys=selector;return Array.isArray(selector)||(keys=[keys]),keys.map(function(key){return just.get(state,key)})}(state,selector),just.compare(previousSelection,selection)||onChange.apply(this,selection.concat([state]))}handlers.push(handleChange),handleChange()},onMatch:function(selector,onTrue,onFalse){var selection;function handleChange(){var previousSelection=selection;selection=selector(state),!previousSelection&&selection&&onTrue(state),onFalse&&previousSelection&&!selection&&onFalse(state)}handlers.push(handleChange),handleChange()}}}}}();